<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Law Brewing: Prohibition Run (Pro Engine)</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { border: 4px solid #d4af37; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <script>
        // --- CONFIGURATION ---
        // This is where you tune the game without breaking the code
        const TILE_SIZE = 128; // We force all tiles to this size
        const SPEED = 300;
        
        // --- ASSET DEFINITIONS ---
        // We define the grids here. 
        // "frameWidth/Height" is the math that fixes the "blurry blob" issue.
        // Assuming your uploaded roads.jpg is square, we divide width by 2.
        // Assuming buildings2.jpg has 3 buildings side-by-side.
        const ASSETS = {
            roads: { key: 'roads', url: 'https://lawbrewing.github.io/LawBrewing/roads.jpg', width: 512, height: 512 }, 
            buildings: { key: 'buildings', url: 'https://lawbrewing.github.io/LawBrewing/buildings2.jpg', width: 512, height: 512 }, 
            truck: { key: 'truck', url: 'https://lawbrewing.github.io/LawBrewing/green.png' }
        };

        // --- THE MAP DESIGN ---
        // Index: 0=Straight, 1=Cross, 2=T-Junction, 3=Corner (Based on standard 2x2 grids)
        // Angle: 0, 90, 180, 270 (Rotates the road)
        // Building: 'null' or index number from the building sheet
        const levelMap = [
            { x: 1, y: 1, type: 'road', frame: 3, angle: 90 },  // Corner
            { x: 2, y: 1, type: 'road', frame: 0, angle: 90 },  // Straight
            { x: 3, y: 1, type: 'road', frame: 0, angle: 90 },  // Straight
            { x: 4, y: 1, type: 'road', frame: 2, angle: 180 }, // T-Junction
            { x: 4, y: 2, type: 'road', frame: 0, angle: 0 },   // Straight down
            { x: 4, y: 3, type: 'road', frame: 3, angle: 180 }, // Corner
            { x: 3, y: 3, type: 'road', frame: 0, angle: 90 },  // Straight Left
            { x: 2, y: 3, type: 'road', frame: 1, angle: 0 },   // Cross
            
            // Buildings (Placed on top of coordinates)
            { x: 2, y: 0, type: 'building', frame: 0 }, // Town Hall?
            { x: 5, y: 1, type: 'building', frame: 1 }, // Lambeau?
            { x: 1, y: 3, type: 'building', frame: 2 }  // Pub?
        ];

        // --- THE ENGINE ---
        const config = {
            type: Phaser.AUTO,
            width: 1024,
            height: 768,
            parent: 'game-container',
            backgroundColor: '#1b301b', // "Packers Green" background
            physics: { default: 'arcade' },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player, cursors;

        function preload() {
            // Load Roads (2x2 Grid)
            // We assume the image is large, so we divide by 2 to get frame size
            this.load.spritesheet(ASSETS.roads.key, ASSETS.roads.url, { 
                frameWidth: 1024/2, frameHeight: 1024/2 
            });

            // Load Buildings (1x3 Grid)
            // We assume the image is wide, containing 3 buildings
            this.load.spritesheet(ASSETS.buildings.key, ASSETS.buildings.url, { 
                frameWidth: 1600/3, frameHeight: 400 // Estimating size - may need tweaking
            });

            this.load.image(ASSETS.truck.key, ASSETS.truck.url);
        }

        function create() {
            // 1. GENERATE MAP FROM DATA
            levelMap.forEach(tile => {
                let posX = tile.x * TILE_SIZE;
                let posY = tile.y * TILE_SIZE;

                if (tile.type === 'road') {
                    // Create Road Tile
                    let r = this.add.image(posX, posY, ASSETS.roads.key, tile.frame);
                    r.setDisplaySize(TILE_SIZE, TILE_SIZE);
                    r.setAngle(tile.angle);
                } 
                else if (tile.type === 'building') {
                    // Create Building Object
                    let b = this.add.image(posX, posY, ASSETS.buildings.key, tile.frame);
                    // Scale buildings slightly larger than the tile so they look tall
                    b.setDisplaySize(TILE_SIZE * 1.5, TILE_SIZE * 1.5);
                    b.setDepth(10); // Ensure building sits "above" the road
                }
            });

            // 2. PLAYER SETUP
            player = this.physics.add.sprite(TILE_SIZE * 2, TILE_SIZE * 1, ASSETS.truck.key);
            player.setDisplaySize(80, 50); // Scale truck to fit vector art style
            player.setDepth(20); // Truck sits above buildings and roads
            player.setCollideWorldBounds(true);

            // 3. CAMERA & UI
            this.cameras.main.startFollow(player, true, 0.1, 0.1);
            this.cameras.main.setZoom(1.2);

            this.add.text(20, 20, 'LAW BREWING: PROHIBITION RUN', { 
                fontSize: '24px', fill: '#d4af37', fontFamily: 'Georgia' 
            }).setScrollFactor(0).setDepth(100);

            cursors = this.input.keyboard.createCursorKeys();
        }

        function update() {
            player.setVelocity(0);

            if (cursors.left.isDown) {
                player.setVelocityX(-SPEED);
                player.setAngle(180);
                player.setFlipY(true);
            } else if (cursors.right.isDown) {
                player.setVelocityX(SPEED);
                player.setAngle(0);
                player.setFlipY(false);
            } else if (cursors.up.isDown) {
                player.setVelocityY(-SPEED);
                player.setAngle(-90);
            } else if (cursors.down.isDown) {
                player.setVelocityY(SPEED);
                player.setAngle(90);
            }
        }
    </script>
</body>
</html>
